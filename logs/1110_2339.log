2025-11-10 23:39:10 - root - INFO - Logging setup complete. Outputting to console and file: logs/1110_2339.log
2025-11-10 23:39:10 - root - INFO - Initialized all random seeds to: 42
2025-11-10 23:39:10 - __main__ - INFO - Using device: cuda
2025-11-10 23:39:10 - __main__ - INFO - Starting run: 1110_2339
2025-11-10 23:39:10 - __main__ - INFO - --- Initializing Models ---
2025-11-10 23:39:10 - root - INFO - [EmbeddingModel] Loading embedding model: all-MiniLM-L6-v2...
2025-11-10 23:39:10 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-11-10 23:39:20 - root - INFO - [EmbeddingModel] Model loaded. Embedding dimension: 384
2025-11-10 23:39:20 - models.llm_wrapper - INFO - Loading LLM environment: Qwen/Qwen3-0.6B...
2025-11-10 23:39:24 - models.llm_wrapper - INFO - LLM 'Qwen/Qwen3-0.6B' loaded successfully.
2025-11-10 23:39:24 - models.policy_network - INFO - Initializing PolicyNetwork (Type: LSTM)
2025-11-10 23:39:24 - __main__ - INFO - Successfully loaded pre-trained MMR weights from: checkpoints/pretrain/mtop_pretrained.pt
2025-11-10 23:39:24 - __main__ - INFO - --- Loading Data ---
2025-11-10 23:39:24 - data_utils.mtop_loader - INFO - --- Creating Corpus (Action Space) ---
2025-11-10 23:39:24 - data_utils.mtop_loader - INFO - Loading full 'train' split (no global cache used)...
2025-11-10 23:39:32 - data_utils.mtop_loader - INFO - Loading EmbeddingModel (all-MiniLM-L6-v2) for K-Means/Sampling...
2025-11-10 23:39:32 - root - INFO - [EmbeddingModel] Loading embedding model: all-MiniLM-L6-v2...
2025-11-10 23:39:32 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-11-10 23:39:39 - root - INFO - [EmbeddingModel] Model loaded. Embedding dimension: 384
2025-11-10 23:39:39 - data_utils.mtop_loader - INFO - Pre-computing all training data embeddings...
2025-11-10 23:39:40 - data_utils.mtop_loader - INFO - Full train data and embeddings loaded (15667 samples).
2025-11-10 23:39:40 - data_utils.mtop_loader - WARNING - USE_CLUSTERED_CORPUS=False. Using the *entire* training dataset (15667 samples) as corpus.
2025-11-10 23:39:40 - data_utils.mtop_loader - INFO - Corpus created. Final size: 15667
2025-11-10 23:39:40 - __main__ - INFO - Corpus embeddings computed. Shape: torch.Size([15667, 384])
2025-11-10 23:39:40 - data_utils.mtop_loader - INFO - Loading query dataloader (split=train, batch_size=16, shuffle=True)...
2025-11-10 23:39:40 - data_utils.mtop_loader - INFO - Loading 'train' split data from Hugging Face...
2025-11-10 23:39:45 - data_utils.mtop_loader - INFO - Randomly sampling 5000 examples for 'train' split...
2025-11-10 23:39:45 - data_utils.mtop_loader - INFO - Loading query dataloader (split=dev, batch_size=64, shuffle=False)...
2025-11-10 23:39:47 - __main__ - INFO - --- Initializing PPO Components ---
2025-11-10 23:39:47 - engine.sampler - INFO - EpisodeSampler initialized for 4 steps.
2025-11-10 23:39:47 - engine.reward_computer - INFO - RewardComputer initialized with GAE (gamma=0.99, lambda=0.95)
2025-11-10 23:39:47 - __main__ - INFO - --- Starting Training Loop ---
2025-11-10 23:39:47 - __main__ - INFO - --- Running Initial kNN Baseline Evaluation ---
2025-11-10 23:39:47 - __main__ - INFO - --- kNN Baseline Evaluation Finished ---
2025-11-10 23:39:47 - __main__ - INFO - Starting Epoch 1/100
2025-11-10 23:40:32 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 1...
2025-11-10 23:42:25 - __main__ - INFO - Evaluation Epoch 1 (Mode: POLICY) Finished. Accuracy: 33.51% (749/2235), Avg NLL: 0.0513
2025-11-10 23:42:25 - __main__ - INFO - Saving evaluation results to file...
2025-11-10 23:42:25 - __main__ - INFO - Evaluation results saved to: outputs/val_results_1110_2339_epoch_1_policy.csv
2025-11-10 23:42:25 - __main__ - INFO - New best validation accuracy: 33.51%! Saving model...
2025-11-10 23:42:25 - __main__ - INFO - Starting Epoch 2/100
2025-11-10 23:43:08 - __main__ - INFO - Starting Epoch 3/100
2025-11-10 23:43:52 - __main__ - INFO - Starting Epoch 4/100
2025-11-10 23:44:35 - __main__ - INFO - Starting Epoch 5/100
2025-11-10 23:45:18 - __main__ - INFO - Starting Epoch 6/100
2025-11-10 23:46:01 - __main__ - INFO - Starting Epoch 7/100
2025-11-10 23:46:44 - __main__ - INFO - Starting Epoch 8/100
2025-11-10 23:47:27 - __main__ - INFO - Starting Epoch 9/100
2025-11-10 23:48:11 - __main__ - INFO - Starting Epoch 10/100
2025-11-10 23:48:54 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 10...
2025-11-10 23:50:47 - __main__ - INFO - Evaluation Epoch 10 (Mode: POLICY) Finished. Accuracy: 33.02% (738/2235), Avg NLL: 0.0510
2025-11-10 23:50:47 - __main__ - INFO - Saving evaluation results to file...
2025-11-10 23:50:47 - __main__ - INFO - Evaluation results saved to: outputs/val_results_1110_2339_epoch_10_policy.csv
2025-11-10 23:50:47 - __main__ - INFO - Starting Epoch 11/100
2025-11-10 23:51:31 - __main__ - INFO - Starting Epoch 12/100
2025-11-10 23:52:14 - __main__ - INFO - Starting Epoch 13/100
2025-11-10 23:52:57 - __main__ - INFO - Starting Epoch 14/100
2025-11-10 23:53:41 - __main__ - INFO - Starting Epoch 15/100
2025-11-10 23:54:38 - __main__ - INFO - Starting Epoch 16/100
2025-11-10 23:55:34 - __main__ - INFO - Starting Epoch 17/100
2025-11-10 23:56:18 - __main__ - INFO - Starting Epoch 18/100
2025-11-10 23:57:01 - __main__ - INFO - Starting Epoch 19/100
2025-11-10 23:57:44 - __main__ - INFO - Starting Epoch 20/100
2025-11-10 23:58:28 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 20...
2025-11-11 00:00:04 - __main__ - INFO - Evaluation Epoch 20 (Mode: POLICY) Finished. Accuracy: 33.33% (745/2235), Avg NLL: 0.0510
2025-11-11 00:00:04 - __main__ - INFO - Saving evaluation results to file...
2025-11-11 00:00:04 - __main__ - INFO - Evaluation results saved to: outputs/val_results_1110_2339_epoch_20_policy.csv
2025-11-11 00:00:04 - __main__ - INFO - Starting Epoch 21/100
2025-11-11 00:00:47 - __main__ - INFO - Starting Epoch 22/100
2025-11-11 00:01:31 - __main__ - INFO - Starting Epoch 23/100
2025-11-11 00:02:14 - __main__ - INFO - Starting Epoch 24/100
2025-11-11 00:02:57 - __main__ - INFO - Starting Epoch 25/100
2025-11-11 00:03:41 - __main__ - INFO - Starting Epoch 26/100
2025-11-11 00:04:25 - __main__ - INFO - Starting Epoch 27/100
2025-11-11 00:05:07 - __main__ - INFO - Starting Epoch 28/100
2025-11-11 00:05:51 - __main__ - INFO - Starting Epoch 29/100
2025-11-11 00:06:34 - __main__ - INFO - Starting Epoch 30/100
2025-11-11 00:07:18 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 30...
2025-11-11 00:08:59 - __main__ - INFO - Evaluation Epoch 30 (Mode: POLICY) Finished. Accuracy: 33.15% (741/2235), Avg NLL: 0.0528
2025-11-11 00:08:59 - __main__ - INFO - Saving evaluation results to file...
2025-11-11 00:08:59 - __main__ - INFO - Evaluation results saved to: outputs/val_results_1110_2339_epoch_30_policy.csv
2025-11-11 00:08:59 - __main__ - INFO - Starting Epoch 31/100
2025-11-11 00:09:43 - __main__ - INFO - Starting Epoch 32/100
2025-11-11 00:10:27 - __main__ - INFO - Starting Epoch 33/100
2025-11-11 00:11:11 - __main__ - INFO - Starting Epoch 34/100
2025-11-11 00:11:55 - __main__ - INFO - Starting Epoch 35/100
2025-11-11 00:12:39 - __main__ - INFO - Starting Epoch 36/100
2025-11-11 00:13:22 - __main__ - INFO - Starting Epoch 37/100
2025-11-11 00:14:06 - __main__ - INFO - Starting Epoch 38/100
2025-11-11 00:14:50 - __main__ - INFO - Starting Epoch 39/100
2025-11-11 00:15:33 - __main__ - INFO - Starting Epoch 40/100
2025-11-11 00:16:17 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 40...
2025-11-11 00:18:20 - __main__ - INFO - Evaluation Epoch 40 (Mode: POLICY) Finished. Accuracy: 32.84% (734/2235), Avg NLL: 0.0519
2025-11-11 00:18:20 - __main__ - INFO - Saving evaluation results to file...
2025-11-11 00:18:20 - __main__ - INFO - Evaluation results saved to: outputs/val_results_1110_2339_epoch_40_policy.csv
2025-11-11 00:18:20 - __main__ - INFO - Starting Epoch 41/100
2025-11-11 00:19:04 - __main__ - INFO - Starting Epoch 42/100
2025-11-11 00:19:47 - __main__ - INFO - Starting Epoch 43/100
2025-11-11 00:20:31 - __main__ - INFO - Starting Epoch 44/100
2025-11-11 00:21:15 - __main__ - INFO - Starting Epoch 45/100
2025-11-11 00:21:59 - __main__ - INFO - Starting Epoch 46/100
2025-11-11 00:22:42 - __main__ - INFO - Starting Epoch 47/100
2025-11-11 00:23:26 - __main__ - INFO - Starting Epoch 48/100
2025-11-11 00:24:10 - __main__ - INFO - Starting Epoch 49/100
2025-11-11 00:24:54 - __main__ - INFO - Starting Epoch 50/100
2025-11-11 00:25:37 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 50...
2025-11-11 00:27:19 - __main__ - INFO - Evaluation Epoch 50 (Mode: POLICY) Finished. Accuracy: 33.91% (758/2235), Avg NLL: 0.0502
2025-11-11 00:27:19 - __main__ - INFO - Saving evaluation results to file...
2025-11-11 00:27:19 - __main__ - INFO - Evaluation results saved to: outputs/val_results_1110_2339_epoch_50_policy.csv
2025-11-11 00:27:19 - __main__ - INFO - New best validation accuracy: 33.91%! Saving model...
2025-11-11 00:27:19 - __main__ - INFO - Starting Epoch 51/100
2025-11-11 00:28:04 - __main__ - INFO - Starting Epoch 52/100
2025-11-11 00:28:48 - __main__ - INFO - Starting Epoch 53/100
2025-11-11 00:29:32 - __main__ - INFO - Starting Epoch 54/100
2025-11-11 00:30:15 - __main__ - INFO - Starting Epoch 55/100
2025-11-11 00:31:00 - __main__ - INFO - Starting Epoch 56/100
2025-11-11 00:31:44 - __main__ - INFO - Starting Epoch 57/100
2025-11-11 00:32:28 - __main__ - INFO - Starting Epoch 58/100
2025-11-11 00:33:12 - __main__ - INFO - Starting Epoch 59/100
2025-11-11 00:33:56 - __main__ - INFO - Starting Epoch 60/100
2025-11-11 00:34:40 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 60...
2025-11-11 00:36:23 - __main__ - INFO - Evaluation Epoch 60 (Mode: POLICY) Finished. Accuracy: 35.30% (789/2235), Avg NLL: 0.0502
2025-11-11 00:36:23 - __main__ - INFO - Saving evaluation results to file...
2025-11-11 00:36:23 - __main__ - INFO - Evaluation results saved to: outputs/val_results_1110_2339_epoch_60_policy.csv
2025-11-11 00:36:23 - __main__ - INFO - New best validation accuracy: 35.30%! Saving model...
2025-11-11 00:36:23 - __main__ - INFO - Starting Epoch 61/100
2025-11-11 00:37:08 - __main__ - INFO - Starting Epoch 62/100
2025-11-11 00:37:52 - __main__ - INFO - Starting Epoch 63/100
2025-11-11 00:38:35 - __main__ - INFO - Starting Epoch 64/100
2025-11-11 00:39:19 - __main__ - INFO - Starting Epoch 65/100
2025-11-11 00:40:02 - __main__ - INFO - Starting Epoch 66/100
2025-11-11 00:40:46 - __main__ - INFO - Starting Epoch 67/100
2025-11-11 00:41:29 - __main__ - INFO - Starting Epoch 68/100
2025-11-11 00:42:13 - __main__ - INFO - Starting Epoch 69/100
2025-11-11 00:42:57 - __main__ - INFO - Starting Epoch 70/100
2025-11-11 00:43:41 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 70...
2025-11-11 00:45:17 - __main__ - INFO - Evaluation Epoch 70 (Mode: POLICY) Finished. Accuracy: 33.24% (743/2235), Avg NLL: 0.0515
2025-11-11 00:45:17 - __main__ - INFO - Saving evaluation results to file...
2025-11-11 00:45:17 - __main__ - INFO - Evaluation results saved to: outputs/val_results_1110_2339_epoch_70_policy.csv
2025-11-11 00:45:17 - __main__ - INFO - Starting Epoch 71/100
2025-11-11 00:46:01 - __main__ - INFO - Starting Epoch 72/100
2025-11-11 00:46:45 - __main__ - INFO - Starting Epoch 73/100
2025-11-11 00:47:29 - __main__ - INFO - Starting Epoch 74/100
2025-11-11 00:48:13 - __main__ - INFO - Starting Epoch 75/100
2025-11-11 00:48:57 - __main__ - INFO - Starting Epoch 76/100
2025-11-11 00:49:40 - __main__ - INFO - Starting Epoch 77/100
2025-11-11 00:50:24 - __main__ - INFO - Starting Epoch 78/100
2025-11-11 00:51:08 - __main__ - INFO - Starting Epoch 79/100
2025-11-11 00:51:52 - __main__ - INFO - Starting Epoch 80/100
2025-11-11 00:52:36 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 80...
2025-11-11 00:54:34 - __main__ - INFO - Evaluation Epoch 80 (Mode: POLICY) Finished. Accuracy: 33.51% (749/2235), Avg NLL: 0.0499
2025-11-11 00:54:34 - __main__ - INFO - Saving evaluation results to file...
2025-11-11 00:54:34 - __main__ - INFO - Evaluation results saved to: outputs/val_results_1110_2339_epoch_80_policy.csv
2025-11-11 00:54:34 - __main__ - INFO - Starting Epoch 81/100
2025-11-11 00:55:19 - __main__ - INFO - Starting Epoch 82/100
2025-11-11 00:56:03 - __main__ - INFO - Starting Epoch 83/100
2025-11-11 00:56:47 - __main__ - INFO - Starting Epoch 84/100
2025-11-11 00:57:32 - __main__ - INFO - Starting Epoch 85/100
2025-11-11 00:58:15 - __main__ - INFO - Starting Epoch 86/100
2025-11-11 00:58:59 - __main__ - INFO - Starting Epoch 87/100
2025-11-11 00:59:43 - __main__ - INFO - Starting Epoch 88/100
2025-11-11 01:00:27 - __main__ - INFO - Starting Epoch 89/100
2025-11-11 01:01:10 - __main__ - INFO - Starting Epoch 90/100
2025-11-11 01:01:54 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 90...
2025-11-11 01:03:30 - __main__ - INFO - Evaluation Epoch 90 (Mode: POLICY) Finished. Accuracy: 32.53% (727/2235), Avg NLL: 0.0508
2025-11-11 01:03:30 - __main__ - INFO - Saving evaluation results to file...
2025-11-11 01:03:30 - __main__ - INFO - Evaluation results saved to: outputs/val_results_1110_2339_epoch_90_policy.csv
2025-11-11 01:03:30 - __main__ - INFO - Starting Epoch 91/100
2025-11-11 01:04:14 - __main__ - INFO - Starting Epoch 92/100
2025-11-11 01:04:59 - __main__ - INFO - Starting Epoch 93/100
2025-11-11 01:05:43 - __main__ - INFO - Starting Epoch 94/100
2025-11-11 01:06:30 - __main__ - INFO - Starting Epoch 95/100
2025-11-11 01:07:29 - __main__ - INFO - Starting Epoch 96/100
2025-11-11 01:08:28 - __main__ - INFO - Starting Epoch 97/100
2025-11-11 01:09:27 - __main__ - INFO - Starting Epoch 98/100
2025-11-11 01:10:25 - __main__ - INFO - Starting Epoch 99/100
2025-11-11 01:11:24 - __main__ - INFO - Starting Epoch 100/100
2025-11-11 01:12:23 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 100...
2025-11-11 01:14:13 - __main__ - INFO - Evaluation Epoch 100 (Mode: POLICY) Finished. Accuracy: 32.57% (728/2235), Avg NLL: 0.0533
2025-11-11 01:14:13 - __main__ - INFO - Saving evaluation results to file...
2025-11-11 01:14:13 - __main__ - INFO - Evaluation results saved to: outputs/val_results_1110_2339_epoch_100_policy.csv
2025-11-11 01:14:13 - __main__ - INFO - --- Final evaluation after all epochs ---
2025-11-11 01:14:13 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch final...
2025-11-11 01:15:46 - __main__ - INFO - Evaluation Epoch final (Mode: POLICY) Finished. Accuracy: 32.30% (722/2235), Avg NLL: 0.0530
2025-11-11 01:15:46 - __main__ - INFO - Saving evaluation results to file...
2025-11-11 01:15:46 - __main__ - INFO - Evaluation results saved to: outputs/val_results_1110_2339_epoch_final_policy.csv
2025-11-11 01:15:46 - __main__ - INFO - Final post-training evaluation accuracy: 32.30%
2025-11-11 01:15:46 - __main__ - INFO - --- Training Finished ---
2025-11-11 01:15:46 - __main__ - INFO - Best validation accuracy: 35.30%
