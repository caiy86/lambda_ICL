2025-11-08 01:13:37 - root - INFO - Logging setup complete. Outputting to console and file: logs/rl_icl_qwen_1108_0113.log
2025-11-08 01:13:37 - root - INFO - Initialized all random seeds to: 42
2025-11-08 01:13:37 - __main__ - INFO - Using device: cuda
2025-11-08 01:13:37 - __main__ - INFO - Starting run: rl_icl_qwen_1108_0113
2025-11-08 01:13:37 - __main__ - INFO - --- Initializing Models ---
2025-11-08 01:13:37 - root - INFO - [EmbeddingModel] Loading embedding model: all-MiniLM-L6-v2...
2025-11-08 01:13:37 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-11-08 01:13:43 - root - INFO - [EmbeddingModel] Model loaded. Embedding dimension: 384
2025-11-08 01:13:43 - models.llm_wrapper - INFO - Loading LLM environment: Qwen/Qwen3-0.6B...
2025-11-08 01:13:46 - models.llm_wrapper - INFO - LLM 'Qwen/Qwen3-0.6B' loaded successfully.
2025-11-08 01:13:46 - models.policy_network - INFO - Initializing PolicyNetwork (Type: LSTM)
2025-11-08 01:13:46 - __main__ - INFO - Successfully loaded pre-trained MMR weights from: checkpoints/rl_icl_qwen_mmr_pretrained.pt
2025-11-08 01:13:46 - __main__ - INFO - --- Loading Data ---
2025-11-08 01:13:46 - data_utils.mtop_loader - INFO - Loading MTOP corpus (from 'train' split)...
2025-11-08 01:13:53 - data_utils.mtop_loader - INFO - Loaded 15667 examples into corpus.
2025-11-08 01:13:53 - __main__ - INFO - Pre-computing corpus embeddings...
2025-11-08 01:13:55 - __main__ - INFO - Corpus embeddings computed. Shape: torch.Size([15667, 384])
2025-11-08 01:13:55 - data_utils.mtop_loader - INFO - Loading MTOP query dataloader (split=train, batch_size=16, shuffle=True)...
2025-11-08 01:13:58 - data_utils.mtop_loader - INFO - Loading MTOP query dataloader (split=dev, batch_size=64, shuffle=False)...
2025-11-08 01:14:00 - __main__ - INFO - --- Initializing PPO Components ---
2025-11-08 01:14:00 - engine.sampler - INFO - EpisodeSampler initialized for 4 steps.
2025-11-08 01:14:00 - engine.reward_computer - INFO - RewardComputer initialized with GAE (gamma=0.99, lambda=0.95)
2025-11-08 01:14:00 - __main__ - INFO - --- Starting Training Loop ---
2025-11-08 01:14:00 - __main__ - INFO - --- Running Initial kNN Baseline Evaluation ---
2025-11-08 01:14:00 - __main__ - INFO - --- kNN Baseline Evaluation Finished ---
2025-11-08 01:14:00 - __main__ - INFO - Starting Epoch 1/100
2025-11-08 01:16:05 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 1...
2025-11-08 01:17:56 - __main__ - INFO - Evaluation Epoch 1 (Mode: POLICY) Finished. Accuracy: 22.28% (498/2235), Avg NLL: 0.0702
2025-11-08 01:17:56 - __main__ - INFO - Saving evaluation results to file...
2025-11-08 01:17:56 - __main__ - INFO - Evaluation results saved to: outputs/val_results_rl_icl_qwen_1108_0113_epoch_1_policy.csv
2025-11-08 01:17:56 - __main__ - INFO - New best validation accuracy: 22.28%! Saving model...
2025-11-08 01:17:56 - __main__ - INFO - Starting Epoch 2/100
2025-11-08 01:20:05 - __main__ - INFO - Starting Epoch 3/100
2025-11-08 01:22:25 - __main__ - INFO - Starting Epoch 4/100
2025-11-08 01:24:39 - __main__ - INFO - Starting Epoch 5/100
2025-11-08 01:26:59 - __main__ - INFO - Starting Epoch 6/100
2025-11-08 01:29:36 - __main__ - INFO - Starting Epoch 7/100
2025-11-08 01:31:54 - __main__ - INFO - Starting Epoch 8/100
2025-11-08 01:34:12 - __main__ - INFO - Starting Epoch 9/100
2025-11-08 01:36:42 - __main__ - INFO - Starting Epoch 10/100
2025-11-08 01:39:29 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 10...
2025-11-08 01:41:22 - __main__ - INFO - Evaluation Epoch 10 (Mode: POLICY) Finished. Accuracy: 24.92% (557/2235), Avg NLL: 0.0594
2025-11-08 01:41:22 - __main__ - INFO - Saving evaluation results to file...
2025-11-08 01:41:22 - __main__ - INFO - Evaluation results saved to: outputs/val_results_rl_icl_qwen_1108_0113_epoch_10_policy.csv
2025-11-08 01:41:22 - __main__ - INFO - New best validation accuracy: 24.92%! Saving model...
2025-11-08 01:41:22 - __main__ - INFO - Starting Epoch 11/100
2025-11-08 01:43:40 - __main__ - INFO - Starting Epoch 12/100
2025-11-08 01:45:55 - __main__ - INFO - Starting Epoch 13/100
2025-11-08 01:48:36 - __main__ - INFO - Starting Epoch 14/100
2025-11-08 01:51:22 - __main__ - INFO - Starting Epoch 15/100
2025-11-08 01:54:00 - __main__ - INFO - Starting Epoch 16/100
2025-11-08 01:56:44 - __main__ - INFO - Starting Epoch 17/100
2025-11-08 01:59:31 - __main__ - INFO - Starting Epoch 18/100
2025-11-08 02:02:08 - __main__ - INFO - Starting Epoch 19/100
2025-11-08 02:04:53 - __main__ - INFO - Starting Epoch 20/100
2025-11-08 02:07:40 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 20...
2025-11-08 02:09:17 - __main__ - INFO - Evaluation Epoch 20 (Mode: POLICY) Finished. Accuracy: 25.82% (577/2235), Avg NLL: 0.0550
2025-11-08 02:09:17 - __main__ - INFO - Saving evaluation results to file...
2025-11-08 02:09:17 - __main__ - INFO - Evaluation results saved to: outputs/val_results_rl_icl_qwen_1108_0113_epoch_20_policy.csv
2025-11-08 02:09:17 - __main__ - INFO - New best validation accuracy: 25.82%! Saving model...
2025-11-08 02:09:17 - __main__ - INFO - Starting Epoch 21/100
2025-11-08 02:11:39 - __main__ - INFO - Starting Epoch 22/100
2025-11-08 02:14:25 - __main__ - INFO - Starting Epoch 23/100
2025-11-08 02:17:01 - __main__ - INFO - Starting Epoch 24/100
2025-11-08 02:19:47 - __main__ - INFO - Starting Epoch 25/100
2025-11-08 02:22:35 - __main__ - INFO - Starting Epoch 26/100
2025-11-08 02:25:21 - __main__ - INFO - Starting Epoch 27/100
2025-11-08 02:27:58 - __main__ - INFO - Starting Epoch 28/100
2025-11-08 02:30:44 - __main__ - INFO - Starting Epoch 29/100
2025-11-08 02:33:29 - __main__ - INFO - Starting Epoch 30/100
2025-11-08 02:36:07 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 30...
2025-11-08 02:37:47 - __main__ - INFO - Evaluation Epoch 30 (Mode: POLICY) Finished. Accuracy: 27.96% (625/2235), Avg NLL: 0.0532
2025-11-08 02:37:47 - __main__ - INFO - Saving evaluation results to file...
2025-11-08 02:37:47 - __main__ - INFO - Evaluation results saved to: outputs/val_results_rl_icl_qwen_1108_0113_epoch_30_policy.csv
2025-11-08 02:37:47 - __main__ - INFO - New best validation accuracy: 27.96%! Saving model...
2025-11-08 02:37:47 - __main__ - INFO - Starting Epoch 31/100
2025-11-08 02:40:06 - __main__ - INFO - Starting Epoch 32/100
2025-11-08 02:42:47 - __main__ - INFO - Starting Epoch 33/100
2025-11-08 02:45:33 - __main__ - INFO - Starting Epoch 34/100
2025-11-08 02:48:10 - __main__ - INFO - Starting Epoch 35/100
2025-11-08 02:50:56 - __main__ - INFO - Starting Epoch 36/100
2025-11-08 02:53:42 - __main__ - INFO - Starting Epoch 37/100
2025-11-08 02:56:28 - __main__ - INFO - Starting Epoch 38/100
2025-11-08 02:59:06 - __main__ - INFO - Starting Epoch 39/100
2025-11-08 03:01:51 - __main__ - INFO - Starting Epoch 40/100
2025-11-08 03:04:37 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 40...
2025-11-08 03:06:56 - __main__ - INFO - Evaluation Epoch 40 (Mode: POLICY) Finished. Accuracy: 30.78% (688/2235), Avg NLL: 0.0500
2025-11-08 03:06:56 - __main__ - INFO - Saving evaluation results to file...
2025-11-08 03:06:56 - __main__ - INFO - Evaluation results saved to: outputs/val_results_rl_icl_qwen_1108_0113_epoch_40_policy.csv
2025-11-08 03:06:56 - __main__ - INFO - New best validation accuracy: 30.78%! Saving model...
2025-11-08 03:06:56 - __main__ - INFO - Starting Epoch 41/100
2025-11-08 03:09:16 - __main__ - INFO - Starting Epoch 42/100
2025-11-08 03:11:56 - __main__ - INFO - Starting Epoch 43/100
2025-11-08 03:14:41 - __main__ - INFO - Starting Epoch 44/100
2025-11-08 03:17:28 - __main__ - INFO - Starting Epoch 45/100
2025-11-08 03:20:05 - __main__ - INFO - Starting Epoch 46/100
2025-11-08 03:22:50 - __main__ - INFO - Starting Epoch 47/100
2025-11-08 03:25:38 - __main__ - INFO - Starting Epoch 48/100
2025-11-08 03:28:23 - __main__ - INFO - Starting Epoch 49/100
2025-11-08 03:31:01 - __main__ - INFO - Starting Epoch 50/100
2025-11-08 03:33:46 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 50...
2025-11-08 03:36:10 - __main__ - INFO - Evaluation Epoch 50 (Mode: POLICY) Finished. Accuracy: 32.17% (719/2235), Avg NLL: 0.0489
2025-11-08 03:36:10 - __main__ - INFO - Saving evaluation results to file...
2025-11-08 03:36:10 - __main__ - INFO - Evaluation results saved to: outputs/val_results_rl_icl_qwen_1108_0113_epoch_50_policy.csv
2025-11-08 03:36:10 - __main__ - INFO - New best validation accuracy: 32.17%! Saving model...
2025-11-08 03:36:10 - __main__ - INFO - Starting Epoch 51/100
2025-11-08 03:38:32 - __main__ - INFO - Starting Epoch 52/100
2025-11-08 03:41:10 - __main__ - INFO - Starting Epoch 53/100
2025-11-08 03:43:56 - __main__ - INFO - Starting Epoch 54/100
2025-11-08 03:46:42 - __main__ - INFO - Starting Epoch 55/100
2025-11-08 03:49:27 - __main__ - INFO - Starting Epoch 56/100
2025-11-08 03:52:05 - __main__ - INFO - Starting Epoch 57/100
2025-11-08 03:54:51 - __main__ - INFO - Starting Epoch 58/100
2025-11-08 03:57:37 - __main__ - INFO - Starting Epoch 59/100
2025-11-08 04:00:22 - __main__ - INFO - Starting Epoch 60/100
2025-11-08 04:03:01 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 60...
2025-11-08 04:04:52 - __main__ - INFO - Evaluation Epoch 60 (Mode: POLICY) Finished. Accuracy: 33.20% (742/2235), Avg NLL: 0.0487
2025-11-08 04:04:52 - __main__ - INFO - Saving evaluation results to file...
2025-11-08 04:04:52 - __main__ - INFO - Evaluation results saved to: outputs/val_results_rl_icl_qwen_1108_0113_epoch_60_policy.csv
2025-11-08 04:04:52 - __main__ - INFO - New best validation accuracy: 33.20%! Saving model...
2025-11-08 04:04:52 - __main__ - INFO - Starting Epoch 61/100
2025-11-08 04:07:13 - __main__ - INFO - Starting Epoch 62/100
2025-11-08 04:09:50 - __main__ - INFO - Starting Epoch 63/100
2025-11-08 04:12:36 - __main__ - INFO - Starting Epoch 64/100
2025-11-08 04:15:22 - __main__ - INFO - Starting Epoch 65/100
2025-11-08 04:17:59 - __main__ - INFO - Starting Epoch 66/100
2025-11-08 04:20:45 - __main__ - INFO - Starting Epoch 67/100
2025-11-08 04:23:31 - __main__ - INFO - Starting Epoch 68/100
2025-11-08 04:26:09 - __main__ - INFO - Starting Epoch 69/100
2025-11-08 04:28:54 - __main__ - INFO - Starting Epoch 70/100
2025-11-08 04:31:40 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 70...
2025-11-08 04:33:37 - __main__ - INFO - Evaluation Epoch 70 (Mode: POLICY) Finished. Accuracy: 32.80% (733/2235), Avg NLL: 0.0482
2025-11-08 04:33:37 - __main__ - INFO - Saving evaluation results to file...
2025-11-08 04:33:37 - __main__ - INFO - Evaluation results saved to: outputs/val_results_rl_icl_qwen_1108_0113_epoch_70_policy.csv
2025-11-08 04:33:37 - __main__ - INFO - Starting Epoch 71/100
2025-11-08 04:35:56 - __main__ - INFO - Starting Epoch 72/100
2025-11-08 04:38:36 - __main__ - INFO - Starting Epoch 73/100
2025-11-08 04:41:22 - __main__ - INFO - Starting Epoch 74/100
2025-11-08 04:43:59 - __main__ - INFO - Starting Epoch 75/100
2025-11-08 04:46:45 - __main__ - INFO - Starting Epoch 76/100
2025-11-08 04:49:31 - __main__ - INFO - Starting Epoch 77/100
2025-11-08 04:52:09 - __main__ - INFO - Starting Epoch 78/100
2025-11-08 04:54:54 - __main__ - INFO - Starting Epoch 79/100
2025-11-08 04:57:40 - __main__ - INFO - Starting Epoch 80/100
2025-11-08 05:00:26 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 80...
2025-11-08 05:02:13 - __main__ - INFO - Evaluation Epoch 80 (Mode: POLICY) Finished. Accuracy: 33.78% (755/2235), Avg NLL: 0.0467
2025-11-08 05:02:13 - __main__ - INFO - Saving evaluation results to file...
2025-11-08 05:02:13 - __main__ - INFO - Evaluation results saved to: outputs/val_results_rl_icl_qwen_1108_0113_epoch_80_policy.csv
2025-11-08 05:02:13 - __main__ - INFO - New best validation accuracy: 33.78%! Saving model...
2025-11-08 05:02:13 - __main__ - INFO - Starting Epoch 81/100
2025-11-08 05:04:35 - __main__ - INFO - Starting Epoch 82/100
2025-11-08 05:07:22 - __main__ - INFO - Starting Epoch 83/100
2025-11-08 05:09:58 - __main__ - INFO - Starting Epoch 84/100
2025-11-08 05:12:44 - __main__ - INFO - Starting Epoch 85/100
2025-11-08 05:15:31 - __main__ - INFO - Starting Epoch 86/100
2025-11-08 05:18:08 - __main__ - INFO - Starting Epoch 87/100
2025-11-08 05:20:54 - __main__ - INFO - Starting Epoch 88/100
2025-11-08 05:23:40 - __main__ - INFO - Starting Epoch 89/100
2025-11-08 05:26:26 - __main__ - INFO - Starting Epoch 90/100
2025-11-08 05:29:03 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 90...
2025-11-08 05:30:54 - __main__ - INFO - Evaluation Epoch 90 (Mode: POLICY) Finished. Accuracy: 33.65% (752/2235), Avg NLL: 0.0481
2025-11-08 05:30:54 - __main__ - INFO - Saving evaluation results to file...
2025-11-08 05:30:54 - __main__ - INFO - Evaluation results saved to: outputs/val_results_rl_icl_qwen_1108_0113_epoch_90_policy.csv
2025-11-08 05:30:54 - __main__ - INFO - Starting Epoch 91/100
2025-11-08 05:33:15 - __main__ - INFO - Starting Epoch 92/100
2025-11-08 05:35:54 - __main__ - INFO - Starting Epoch 93/100
2025-11-08 05:38:39 - __main__ - INFO - Starting Epoch 94/100
2025-11-08 05:41:25 - __main__ - INFO - Starting Epoch 95/100
2025-11-08 05:44:03 - __main__ - INFO - Starting Epoch 96/100
2025-11-08 05:46:49 - __main__ - INFO - Starting Epoch 97/100
2025-11-08 05:49:34 - __main__ - INFO - Starting Epoch 98/100
2025-11-08 05:52:20 - __main__ - INFO - Starting Epoch 99/100
2025-11-08 05:54:58 - __main__ - INFO - Starting Epoch 100/100
2025-11-08 05:57:44 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch 100...
2025-11-08 06:00:04 - __main__ - INFO - Evaluation Epoch 100 (Mode: POLICY) Finished. Accuracy: 34.94% (781/2235), Avg NLL: 0.0474
2025-11-08 06:00:04 - __main__ - INFO - Saving evaluation results to file...
2025-11-08 06:00:05 - __main__ - INFO - Evaluation results saved to: outputs/val_results_rl_icl_qwen_1108_0113_epoch_100_policy.csv
2025-11-08 06:00:05 - __main__ - INFO - New best validation accuracy: 34.94%! Saving model...
2025-11-08 06:00:05 - __main__ - INFO - --- Final evaluation after all epochs ---
2025-11-08 06:00:05 - __main__ - INFO - Starting evaluation (Mode: POLICY) for Epoch final...
2025-11-08 06:02:22 - __main__ - INFO - Evaluation Epoch final (Mode: POLICY) Finished. Accuracy: 33.91% (758/2235), Avg NLL: 0.0461
2025-11-08 06:02:22 - __main__ - INFO - Saving evaluation results to file...
2025-11-08 06:02:22 - __main__ - INFO - Evaluation results saved to: outputs/val_results_rl_icl_qwen_1108_0113_epoch_final_policy.csv
2025-11-08 06:02:22 - __main__ - INFO - Final post-training evaluation accuracy: 33.91%
2025-11-08 06:02:22 - __main__ - INFO - --- Training Finished ---
2025-11-08 06:02:22 - __main__ - INFO - Best validation accuracy: 34.94%
